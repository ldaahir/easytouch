{"version":3,"file":"index-54687bf1.js","sources":["../../../../frontend/src/pages/apps/invoice/list/index.vue"],"sourcesContent":["<script setup>\nimport { VDataTableServer } from 'vuetify/labs/VDataTable'\nimport { paginationMeta } from '@/@fake-db/utils'\nimport { useInvoiceStore } from '@/views/apps/invoice/useInvoiceStore'\nimport { avatarText } from '@core/utils/formatters'\n\nconst invoiceListStore = useInvoiceStore()\nconst searchQuery = ref('')\nconst dateRange = ref('')\nconst selectedStatus = ref()\nconst totalInvoices = ref(0)\nconst invoices = ref([])\nconst selectedRows = ref([])\n\nconst options = ref({\n  page: 1,\n  itemsPerPage: 10,\n  sortBy: [],\n  groupBy: [],\n  search: undefined,\n})\n\nconst isLoading = ref(false)\nconst currentPage = ref(1)\n\ncurrentPage.value = options.value.page\n\n// ðŸ‘‰ headers\nconst headers = [\n  {\n    title: '#ID',\n    key: 'id',\n  },\n  {\n    title: 'Trending',\n    key: 'trending',\n    sortable: false,\n  },\n  {\n    title: 'Client',\n    key: 'client',\n  },\n  {\n    title: 'Total',\n    key: 'total',\n  },\n  {\n    title: 'Issued Date',\n    key: 'date',\n  },\n  {\n    title: 'Balance',\n    key: 'balance',\n  },\n  {\n    title: 'Actions',\n    key: 'actions',\n    sortable: false,\n  },\n]\n\n// ðŸ‘‰ Fetch Invoices\nconst fetchInvoices = (query, currentStatus, firstDate, lastDate, option) => {\n  isLoading.value = true\n  invoiceListStore.fetchInvoices({\n    q: query,\n    status: currentStatus,\n    startDate: firstDate,\n    endDate: lastDate,\n    options: option,\n  }).then(response => {\n    invoices.value = response.data.invoices\n    totalInvoices.value = response.data.totalInvoices\n    options.value.page = response.data.page\n  }).catch(error => {\n    console.log(error)\n  })\n  isLoading.value = false\n}\n\n// ðŸ‘‰ Invoice balance variant resolver\nconst resolveInvoiceBalanceVariant = (balance, total) => {\n  if (balance === total)\n    return {\n      status: 'Unpaid',\n      chip: { color: 'error' },\n    }\n  if (balance === 0)\n    return {\n      status: 'Paid',\n      chip: { color: 'success' },\n    }\n  \n  return {\n    status: balance,\n    chip: { variant: 'text' },\n  }\n}\n\nconst resolveInvoiceStatusVariantAndIcon = status => {\n  if (status === 'Partial Payment')\n    return {\n      variant: 'success',\n      icon: 'tabler-circle-half-2',\n    }\n  if (status === 'Paid')\n    return {\n      variant: 'warning',\n      icon: 'tabler-chart-pie',\n    }\n  if (status === 'Downloaded')\n    return {\n      variant: 'info',\n      icon: 'tabler-arrow-down-circle',\n    }\n  if (status === 'Draft')\n    return {\n      variant: 'primary',\n      icon: 'tabler-device-floppy',\n    }\n  if (status === 'Sent')\n    return {\n      variant: 'secondary',\n      icon: 'tabler-circle-check',\n    }\n  if (status === 'Past Due')\n    return {\n      variant: 'error',\n      icon: 'tabler-alert-circle',\n    }\n  \n  return {\n    variant: 'secondary',\n    icon: 'tabler-x',\n  }\n}\n\nconst computedMoreList = computed(() => {\n  return paramId => [\n    {\n      title: 'Download',\n      value: 'download',\n      prependIcon: 'tabler-download',\n    },\n    {\n      title: 'Edit',\n      value: 'edit',\n      prependIcon: 'tabler-pencil',\n      to: {\n        name: 'apps-invoice-edit-id',\n        params: { id: paramId },\n      },\n    },\n    {\n      title: 'Duplicate',\n      value: 'duplicate',\n      prependIcon: 'tabler-layers-intersect',\n    },\n  ]\n})\n\nconst deleteInvoice = id => {\n  invoiceListStore.deleteInvoice(id).then(() => {\n    fetchInvoices(searchQuery.value, selectedStatus.value, dateRange.value?.split('to')[0], dateRange.value?.split('to')[1], options.value)\n  }).catch(error => {\n    console.log(error)\n  })\n}\n\n// ðŸ‘‰ watch for data table options like itemsPerPage,page,searchQuery,sortBy etc...\nwatchEffect(() => {\n  const [start, end] = dateRange.value ? dateRange.value.split('to') : ''\n\n  fetchInvoices(searchQuery.value, selectedStatus.value, start, end, options.value)\n})\n</script>\n\n<template>\n  <VCard\n    v-if=\"invoices\"\n    id=\"invoice-list\"\n  >\n    <VCardText class=\"d-flex align-center flex-wrap gap-4\">\n      <div class=\"me-3 d-flex gap-3\">\n        <AppSelect\n          :model-value=\"options.itemsPerPage\"\n          :items=\"[\n            { value: 10, title: '10' },\n            { value: 25, title: '25' },\n            { value: 50, title: '50' },\n            { value: 100, title: '100' },\n            { value: -1, title: 'All' },\n          ]\"\n          style=\"width: 6.25rem;\"\n          @update:model-value=\"options.itemsPerPage = parseInt($event, 10)\"\n        />\n        <!-- ðŸ‘‰ Create invoice -->\n        <VBtn\n          prepend-icon=\"tabler-plus\"\n          :to=\"{ name: 'apps-invoice-add' }\"\n        >\n          Create invoice\n        </VBtn>\n      </div>\n\n      <VSpacer />\n\n      <div class=\"d-flex align-center flex-wrap gap-4\">\n        <!-- ðŸ‘‰ Search  -->\n        <div class=\"invoice-list-filter\">\n          <AppTextField\n            v-model=\"searchQuery\"\n            placeholder=\"Search Invoice\"\n            density=\"compact\"\n          />\n        </div>\n\n        <!-- ðŸ‘‰ Select status -->\n        <div class=\"invoice-list-filter\">\n          <AppSelect\n            v-model=\"selectedStatus\"\n            placeholder=\"Select Status\"\n            clearable\n            clear-icon=\"tabler-x\"\n            single-line\n            :items=\"['Downloaded', 'Draft', 'Sent', 'Paid', 'Partial Payment', 'Past Due']\"\n          />\n        </div>\n      </div>\n    </VCardText>\n\n    <VDivider />\n\n    <!-- SECTION Datatable -->\n    <VDataTableServer\n      v-model=\"selectedRows\"\n      v-model:items-per-page=\"options.itemsPerPage\"\n      v-model:page=\"options.page\"\n      :loading=\"isLoading\"\n      :items-length=\"totalInvoices\"\n      :headers=\"headers\"\n      :items=\"invoices\"\n      class=\"text-no-wrap\"\n      @update:options=\"options = $event\"\n    >\n      <!-- Trending Header -->\n      <template #column.trending>\n        <VIcon\n          size=\"22\"\n          icon=\"tabler-trending-up\"\n        />\n      </template>\n\n      <!-- id -->\n      <template #item.id=\"{ item }\">\n        <RouterLink :to=\"{ name: 'apps-invoice-preview-id', params: { id: item.value } }\">\n          #{{ item.raw.id }}\n        </RouterLink>\n      </template>\n\n      <!-- trending -->\n      <template #item.trending=\"{ item }\">\n        <VTooltip>\n          <template #activator=\"{ props }\">\n            <VAvatar\n              :size=\"30\"\n              v-bind=\"props\"\n              :color=\"resolveInvoiceStatusVariantAndIcon(item.raw.invoiceStatus).variant\"\n              variant=\"tonal\"\n            >\n              <VIcon\n                :size=\"20\"\n                :icon=\"resolveInvoiceStatusVariantAndIcon(item.raw.invoiceStatus).icon\"\n              />\n            </VAvatar>\n          </template>\n          <p class=\"mb-0\">\n            {{ item.raw.invoiceStatus }}\n          </p>\n          <p class=\"mb-0\">\n            Balance: {{ item.raw.balance }}\n          </p>\n          <p class=\"mb-0\">\n            Due date: {{ item.raw.dueDate }}\n          </p>\n        </VTooltip>\n      </template>\n\n      <!-- client -->\n      <template #item.client=\"{ item }\">\n        <div class=\"d-flex align-center\">\n          <VAvatar\n            size=\"38\"\n            :color=\"!item.raw.avatar.length ? resolveInvoiceStatusVariantAndIcon(item.raw.invoiceStatus).variant : undefined\"\n            :variant=\"!item.raw.avatar.length ? 'tonal' : undefined\"\n            class=\"me-3\"\n          >\n            <VImg\n              v-if=\"item.raw.avatar.length\"\n              :src=\"item.raw.avatar\"\n            />\n            <span v-else>{{ avatarText(item.raw.client.name) }}</span>\n          </VAvatar>\n          <div class=\"d-flex flex-column\">\n            <h6 class=\"text-body-1 font-weight-medium mb-0\">\n              {{ item.raw.client.name }}\n            </h6>\n            <span class=\"text-sm text-disabled\">{{ item.raw.client.companyEmail }}</span>\n          </div>\n        </div>\n      </template>\n\n      <!-- Total -->\n      <template #item.total=\"{ item }\">\n        ${{ item.raw.total }}\n      </template>\n\n      <!-- Date -->\n      <template #item.date=\"{ item }\">\n        {{ item.raw.issuedDate }}\n      </template>\n\n      <!-- Balance -->\n      <template #item.balance=\"{ item }\">\n        <VChip\n          v-if=\"typeof ((resolveInvoiceBalanceVariant(item.raw.balance, item.raw.total)).status) === 'string'\"\n          :color=\"resolveInvoiceBalanceVariant(item.raw.balance, item.raw.total).chip.color\"\n          label\n        >\n          {{ (resolveInvoiceBalanceVariant(item.raw.balance, item.raw.total)).status }}\n        </VChip>\n\n        <template v-else>\n          <span class=\"text-base\">\n            {{ Number((resolveInvoiceBalanceVariant(item.raw.balance, item.raw.total)).status) > 0 ? `$${(resolveInvoiceBalanceVariant(item.raw.balance, item.raw.total)).status}` : `-$${Math.abs(Number((resolveInvoiceBalanceVariant(item.raw.balance, item.raw.total)).status))}` }}\n          </span>\n        </template>\n      </template>\n\n      <!-- Actions -->\n      <template #item.actions=\"{ item }\">\n        <IconBtn @click=\"deleteInvoice(item.raw.id)\">\n          <VIcon icon=\"tabler-trash\" />\n        </IconBtn>\n\n        <IconBtn :to=\"{ name: 'apps-invoice-preview-id', params: { id: item.raw.id } }\">\n          <VIcon icon=\"tabler-eye\" />\n        </IconBtn>\n\n        <MoreBtn\n          :menu-list=\"computedMoreList(item.raw.id)\"\n          item-props\n          color=\"undefined\"\n        />\n      </template>\n\n      <!-- pagination -->\n\n      <template #bottom>\n        <VDivider />\n        <div class=\"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3\">\n          <p class=\"text-sm text-disabled mb-0\">\n            {{ paginationMeta(options, totalInvoices) }}\n          </p>\n\n          <VPagination\n            v-model=\"options.page\"\n            :length=\"Math.ceil(totalInvoices / options.itemsPerPage)\"\n            :total-visible=\"$vuetify.display.xs ? 1 : Math.ceil(totalInvoices / options.itemsPerPage)\"\n          >\n            <template #prev=\"slotProps\">\n              <VBtn\n                variant=\"tonal\"\n                color=\"default\"\n                v-bind=\"slotProps\"\n                :icon=\"false\"\n              >\n                Previous\n              </VBtn>\n            </template>\n\n            <template #next=\"slotProps\">\n              <VBtn\n                variant=\"tonal\"\n                color=\"default\"\n                v-bind=\"slotProps\"\n                :icon=\"false\"\n              >\n                Next\n              </VBtn>\n            </template>\n          </VPagination>\n        </div>\n      </template>\n    </VDataTableServer>\n    <!-- !SECTION -->\n  </VCard>\n</template>\n\n<style lang=\"scss\">\n#invoice-list {\n  .invoice-list-actions {\n    inline-size: 8rem;\n  }\n\n  .invoice-list-filter {\n    inline-size: 12rem;\n  }\n}\n</style>\n"],"names":["invoiceListStore","useInvoiceStore","searchQuery","ref","dateRange","selectedStatus","totalInvoices","invoices","selectedRows","options","isLoading","currentPage","headers","fetchInvoices","query","currentStatus","firstDate","lastDate","option","response","error","resolveInvoiceBalanceVariant","balance","total","resolveInvoiceStatusVariantAndIcon","status","computedMoreList","computed","paramId","deleteInvoice","id","_a","_b","watchEffect","start","end"],"mappings":"mgEAMA,MAAAA,EAAAC,EAAA,EACAC,EAAAC,EAAA,EAAA,EACAC,EAAAD,EAAA,EAAA,EACAE,EAAAF,EAAA,EACAG,EAAAH,EAAA,CAAA,EACAI,EAAAJ,EAAA,EAAA,EACAK,EAAAL,EAAA,EAAA,EAEAM,EAAAN,EAAA,CACA,KAAA,EACA,aAAA,GACA,OAAA,CAAA,EACA,QAAA,CAAA,EACA,OAAA,MACA,CAAA,EAEAO,EAAAP,EAAA,EAAA,EACAQ,EAAAR,EAAA,CAAA,EAEAQ,EAAA,MAAAF,EAAA,MAAA,KAGA,MAAAG,EAAA,CACA,CACA,MAAA,MACA,IAAA,IACA,EACA,CACA,MAAA,WACA,IAAA,WACA,SAAA,EACA,EACA,CACA,MAAA,SACA,IAAA,QACA,EACA,CACA,MAAA,QACA,IAAA,OACA,EACA,CACA,MAAA,cACA,IAAA,MACA,EACA,CACA,MAAA,UACA,IAAA,SACA,EACA,CACA,MAAA,UACA,IAAA,UACA,SAAA,EACA,CACA,EAGAC,EAAA,CAAAC,EAAAC,EAAAC,EAAAC,EAAAC,IAAA,CACAR,EAAA,MAAA,GACAV,EAAA,cAAA,CACA,EAAAc,EACA,OAAAC,EACA,UAAAC,EACA,QAAAC,EACA,QAAAC,CACA,CAAA,EAAA,KAAAC,GAAA,CACAZ,EAAA,MAAAY,EAAA,KAAA,SACAb,EAAA,MAAAa,EAAA,KAAA,cACAV,EAAA,MAAA,KAAAU,EAAA,KAAA,IACA,CAAA,EAAA,MAAAC,GAAA,CACA,QAAA,IAAAA,CAAA,CACA,CAAA,EACAV,EAAA,MAAA,EACA,EAGAW,EAAA,CAAAC,EAAAC,IACAD,IAAAC,EACA,CACA,OAAA,SACA,KAAA,CAAA,MAAA,OAAA,CACA,EACAD,IAAA,EACA,CACA,OAAA,OACA,KAAA,CAAA,MAAA,SAAA,CACA,EAEA,CACA,OAAAA,EACA,KAAA,CAAA,QAAA,MAAA,CACA,EAGAE,EAAAC,GACAA,IAAA,kBACA,CACA,QAAA,UACA,KAAA,sBACA,EACAA,IAAA,OACA,CACA,QAAA,UACA,KAAA,kBACA,EACAA,IAAA,aACA,CACA,QAAA,OACA,KAAA,0BACA,EACAA,IAAA,QACA,CACA,QAAA,UACA,KAAA,sBACA,EACAA,IAAA,OACA,CACA,QAAA,YACA,KAAA,qBACA,EACAA,IAAA,WACA,CACA,QAAA,QACA,KAAA,qBACA,EAEA,CACA,QAAA,YACA,KAAA,UACA,EAGAC,EAAAC,GAAA,IACAC,GAAA,CACA,CACA,MAAA,WACA,MAAA,WACA,YAAA,iBACA,EACA,CACA,MAAA,OACA,MAAA,OACA,YAAA,gBACA,GAAA,CACA,KAAA,uBACA,OAAA,CAAA,GAAAA,CAAA,CACA,CACA,EACA,CACA,MAAA,YACA,MAAA,YACA,YAAA,yBACA,CACA,CACA,EAEAC,EAAAC,GAAA,CACA9B,EAAA,cAAA8B,CAAA,EAAA,KAAA,IAAA,SACAjB,EAAAX,EAAA,MAAAG,EAAA,OAAA0B,EAAA3B,EAAA,QAAA,YAAA2B,EAAA,MAAA,MAAA,IAAAC,EAAA5B,EAAA,QAAA,YAAA4B,EAAA,MAAA,MAAA,GAAAvB,EAAA,KAAA,CACA,CAAA,EAAA,MAAAW,GAAA,CACA,QAAA,IAAAA,CAAA,CACA,CAAA,CACA,EAGA,OAAAa,GAAA,IAAA,CACA,KAAA,CAAAC,EAAAC,CAAA,EAAA/B,EAAA,MAAAA,EAAA,MAAA,MAAA,IAAA,EAAA,GAEAS,EAAAX,EAAA,MAAAG,EAAA,MAAA6B,EAAAC,EAAA1B,EAAA,KAAA,CACA,CAAA"}