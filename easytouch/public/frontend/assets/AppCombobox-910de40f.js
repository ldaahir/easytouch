var ge=Object.defineProperty,ye=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var W=(e,t,i)=>t in e?ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,C=(e,t)=>{for(var i in t||(t={}))Ve.call(t,i)&&W(e,i,t[i]);if(G)for(var i of G(t))Ce.call(t,i)&&W(e,i,t[i]);return e},j=(e,t)=>ye(e,ke(t));import{b as _e,V as we}from"./VInput-ea621834.js";import{m as Ie}from"./VSelect-31041ca2.js";import{f as Ae}from"./forwardRefs-bb5e4b03.js";import{m as Pe,u as De}from"./filter-80b4f4b8.js";import{m as Se}from"./transition-6a62c7af.js";import{u as Fe,t as E,V as Re,a as X}from"./VList-5632fe53.js";import{J as Te,U as $e,$ as Ee,Y as Z,O as Le,a4 as Me,T as Ne,az as Be}from"./index-e1b913cd.js";import{m as Oe,V as ee}from"./VTextField-ae5a2228.js";import{V as Ue}from"./VMenu-71a8a06d.js";import{V as ze}from"./VCheckboxBtn-fb30a6d7.js";import{V as Ke}from"./VChip-a66962cb.js";import{f as _,c as h,d as L,B as le,k as c,M as oe,n as S,Q as je,h as Je,ah as ae,I as te,L as He,u as M,J as Qe,T as Ye,af as qe,N as Ge,K as We,V as Xe,a2 as ne,ag as ue,S as Ze}from"./frappe-ui-26ef7369.js";function el(e,t,i){if(t==null)return e;if(Array.isArray(t))throw new Error("Multiple matches is not implemented");return typeof t=="number"&&~t?c(oe,null,[c("span",{class:"v-combobox__unmask"},[e.substr(0,t)]),c("span",{class:"v-combobox__mask"},[e.substr(t,i)]),c("span",{class:"v-combobox__unmask"},[e.substr(t+i)])]):e}const ll=Te()({name:"VCombobox",props:C(C(C(C({delimiters:Array},Pe({filterKeys:["title"]})),Ie({hideNoData:!0,returnObject:!0})),$e(Oe({modelValue:null}),["validationValue","dirty","appendInnerIcon"])),Se({transition:!1})),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,t){var Q,Y;let{emit:i,slots:a}=t;const{t:A}=Ee(),g=_(),b=_(!1),p=_(!0),J=_(),N=Z(e,"menu"),f=h({get:()=>N.value,set:l=>{var n;N.value&&!l&&((n=J.value)!=null&&n.Î¨openChildren)||(N.value=l)}}),o=_(-1);let B=!1;const se=h(()=>{var l;return(l=g.value)==null?void 0:l.color}),{items:O,transformIn:ie,transformOut:re}=Fe(e),{textColorClasses:ce,textColorStyles:ve}=Le(se),d=Z(e,"modelValue",[],l=>ie(Me(l)),l=>{var s;const n=re(l);return e.multiple?n:(s=n[0])!=null?s:null}),w=_e(),I=_(e.multiple?"":(Y=(Q=d.value[0])==null?void 0:Q.title)!=null?Y:""),v=h({get:()=>I.value,set:l=>{var n;if(I.value=l,e.multiple||(d.value=[E(e,l)]),l&&e.multiple&&((n=e.delimiters)!=null&&n.length)){const s=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));s.length>1&&(s.forEach(x=>{x=x.trim(),x&&V(E(e,x))}),I.value="")}l||(o.value=-1),p.value=!l}});L(I,l=>{B?le(()=>B=!1):b.value&&!f.value&&(f.value=!0),i("update:search",l)}),L(d,l=>{var n,s;e.multiple||(I.value=(s=(n=l[0])==null?void 0:n.title)!=null?s:"")});const{filteredItems:F,getMatches:de}=De(e,O,h(()=>p.value?void 0:v.value)),k=h(()=>d.value.map(l=>O.value.find(n=>e.valueComparator(n.value,l.value))||l)),U=h(()=>e.hideSelected?F.value.filter(l=>!k.value.some(n=>n.value===l.value)):F.value),z=h(()=>k.value.map(l=>l.props.value)),H=h(()=>k.value[o.value]),K=_();function fe(l){B=!0,e.openOnClear&&(f.value=!0)}function me(){e.hideNoData&&!O.value.length||e.readonly||w!=null&&w.isReadonly.value||(f.value=!0)}function be(l){var x,u;if(e.readonly||w!=null&&w.isReadonly.value)return;const n=g.value.selectionStart,s=z.value.length;if((o.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(f.value=!0),["Escape"].includes(l.key)&&(f.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(p.value=!0),l.key==="ArrowDown"?(x=K.value)==null||x.focus("next"):l.key==="ArrowUp"&&((u=K.value)==null||u.focus("prev")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(o.value<0){l.key==="Backspace"&&!v.value&&(o.value=s-1);return}const r=o.value;H.value&&V(H.value),o.value=r>=s-1?s-2:r}if(l.key==="ArrowLeft"){if(o.value<0&&n>0)return;const r=o.value>-1?o.value-1:s-1;k.value[r]?o.value=r:(o.value=-1,g.value.setSelectionRange(v.value.length,v.value.length))}if(l.key==="ArrowRight"){if(o.value<0)return;const r=o.value+1;k.value[r]?o.value=r:(o.value=-1,g.value.setSelectionRange(0,0))}l.key==="Enter"&&v.value&&(V(E(e,v.value)),v.value="")}}function he(){b.value&&(p.value=!0)}function V(l){if(e.multiple){const n=z.value.findIndex(s=>e.valueComparator(s,l.value));if(n===-1)d.value=[...d.value,l];else{const s=[...d.value];s.splice(n,1),d.value=s}v.value=""}else d.value=[l],I.value=l.title,le(()=>{f.value=!1,p.value=!0})}function pe(l){b.value=!0}function xe(l){var n;l.relatedTarget==null&&((n=g.value)==null||n.focus())}return L(F,l=>{!l.length&&e.hideNoData&&(f.value=!1)}),L(b,l=>{if(l)o.value=-1;else{if(f.value=!1,!e.multiple||!v.value)return;d.value=[...d.value,E(e,v.value)],v.value=""}}),Ne(()=>{const l=!!(e.chips||a.chip),n=!!(!e.hideNoData||U.value.length||a.prepend||a.append||a["no-data"]),s=d.value.length>0,[x]=ee.filterProps(e);return c(ee,S({ref:g},x,{modelValue:v.value,"onUpdate:modelValue":[u=>v.value=u,u=>{u==null&&(d.value=[])}],focused:b.value,"onUpdate:focused":u=>b.value=u,validationValue:d.externalValue,dirty:s,class:["v-combobox",{"v-combobox--active-menu":f.value,"v-combobox--chips":!!e.chips,"v-combobox--selecting-index":o.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,appendInnerIcon:e.items.length?e.menuIcon:void 0,readonly:e.readonly,placeholder:s?void 0:e.placeholder,"onClick:clear":fe,"onMousedown:control":me,onKeydown:be}),j(C({},a),{default:()=>c(oe,null,[c(Ue,S({ref:J,modelValue:f.value,"onUpdate:modelValue":u=>f.value=u,activator:"parent",contentClass:"v-combobox__content",eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:he},e.menuProps),{default:()=>[n&&c(Re,{ref:K,selected:z.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:u=>u.preventDefault(),onFocusin:pe,onFocusout:xe},{default:()=>{var u,r,R,P;return[!U.value.length&&!e.hideNoData&&((r=(u=a["no-data"])==null?void 0:u.call(a))!=null?r:c(X,{title:A(e.noDataText)},null)),(R=a["prepend-item"])==null?void 0:R.call(a),U.value.map(m=>{var D,y;return(y=(D=a.item)==null?void 0:D.call(a,{item:m,props:S(m.props,{onClick:()=>V(m)})}))!=null?y:c(X,S({key:m.value},m.props,{onClick:()=>V(m)}),{prepend:T=>{let{isSelected:$}=T;return e.multiple&&!e.hideSelected?c(ze,{modelValue:$,ripple:!1,tabindex:"-1"},null):void 0},title:()=>{var T,$,q;return p.value?m.title:el(m.title,(T=de(m))==null?void 0:T.title,(q=($=v.value)==null?void 0:$.length)!=null?q:0)}})}),(P=a["append-item"])==null?void 0:P.call(a)]}})]}),k.value.map((u,r)=>{var m,D;function R(y){y.stopPropagation(),y.preventDefault(),V(u)}const P={"onClick:close":R,modelValue:!0,"onUpdate:modelValue":void 0};return c("div",{key:u.value,class:["v-combobox__selection",r===o.value&&["v-combobox__selection--selected",ce.value]],style:r===o.value?ve.value:{}},[l?a.chip?c(Be,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:u.title}}},{default:()=>{var y;return[(y=a.chip)==null?void 0:y.call(a,{item:u,index:r,props:P})]}}):c(Ke,S({key:"chip",closable:e.closableChips,size:"small",text:u.title},P),null):(D=(m=a.selection)==null?void 0:m.call(a,{item:u,index:r}))!=null?D:c("span",{class:"v-combobox__selection-text"},[u.title,e.multiple&&r<k.value.length-1&&c("span",{class:"v-combobox__selection-comma"},[je(",")])])])})])}))}),Ae({isFocused:b,isPristine:p,menu:f,search:v,selectionIndex:o,filteredItems:F,select:V},g)}}),al=Je({name:"AppCombobox",inheritAttrs:!1}),hl=Object.assign(al,{setup(e){const t=h(()=>{const a=ae(),A=a.id||a.label;return A?`app-combobox-${A}-${Math.random().toString(36).slice(2,7)}`:void 0}),i=h(()=>ae().label);return(a,A)=>(te(),He("div",{class:Ze(["app-combobox flex-grow-1",a.$attrs.class])},[M(i)?(te(),Qe(we,{key:0,for:M(t),class:"mb-1 text-body-2 text-high-emphasis",text:M(i)},null,8,["for","text"])):Ye("",!0),c(ll,ne(ue(j(C({},a.$attrs),{class:null,label:void 0,variant:"outlined",id:M(t),menuProps:{contentClass:["app-inner-list","app-combobox__content","v-combobox__content",a.$attrs.multiple!==void 0?"v-list-select-multiple":""]}}))),qe({_:2},[Ge(a.$slots,(g,b)=>({name:b,fn:We(p=>[Xe(a.$slots,b,ne(ue(p||{})))])}))]),1040)],2))}});export{ll as V,hl as _};
//# sourceMappingURL=AppCombobox-910de40f.js.map
